{"version":3,"file":"static/js/181.84e61dbd.chunk.js","mappings":"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","sources":["routes/ImageCompressior.js"],"sourcesContent":["import { storageService, dbService } from \"fbase\";\r\nimport imageCompression from 'browser-image-compression';\r\nimport { useState } from \"react\";\r\nimport { uuidv4 } from \"@firebase/util\";\r\n\r\nconst ImageCompressior = () => {\r\n  const [ext, setExt] = useState(\"\");\r\n  const [startDate, setStartDate] = useState(\"\");\r\n  const [endDate, setEndDate] = useState(\"\");\r\n  const [width, setWidth] = useState(300);\r\n  const [height, setHeight] = useState(300);\r\n  \r\n  const doc = 'S9nPnnJhejVZ2HJsVVmYaTxTB732';\r\n  const oldDoc = 'Vf46gZOvLVagkCQbvZxSqXyjrDu1';\r\n  const ref = storageService.ref();\r\n\r\n  // 이미지 다운로드\r\n  const handleImageDownload = () => {\r\n    console.log('이미지 다운로드 시작');\r\n    dbService\r\n      .collection(\"items\")\r\n      .where(\"creatorId\", \"==\", process.env.REACT_APP_ADMIN)\r\n      .where(\"date\", \">=\", startDate)\r\n      .where(\"date\", \"<=\", endDate)\r\n      .orderBy(\"date\", \"desc\")\r\n      .get()\r\n      .then((snapshot) => {\r\n        console.log('이미지 갯수: ', snapshot.docs.length);\r\n        snapshot.docs.forEach((doc) => {\r\n          download(doc.data().attachmentUrl, doc.data().date);\r\n        });\r\n      });    \r\n  }\r\n\r\n  async function download(url, date) {\r\n    console.log(`이미지 호출 : ${date}`);\r\n    const init = await fetch(url, {method: \"get\"});\r\n    const blob = await init.blob();\r\n    let fileName = `${date}.jpg`;\r\n    const createdUrl = URL.createObjectURL(await blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = createdUrl;\r\n    a.download = fileName;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    window.URL.revokeObjectURL(url);\r\n  }\r\n\r\n  async function getItems() {\r\n    let count = 0;\r\n    const items = [];\r\n    return await new Promise((resolve) => {\r\n      dbService\r\n        .collection(\"items\")\r\n        .where(\"creatorId\", \"==\", process.env.REACT_APP_ADMIN)\r\n        .where(\"date\", \">=\", startDate)\r\n        .where(\"date\", \"<=\", endDate)\r\n        .orderBy(\"date\", \"desc\")\r\n        .get()\r\n        .then((snapshot) => {\r\n          snapshot.docs.forEach((doc) => {\r\n            count++;\r\n            items.push({\r\n              num: count, \r\n              id: doc.id, \r\n              date: doc.data().date, \r\n              url: doc.data().attachmentUrl, \r\n              thumbnailUrl: doc.data().thumbnailUrl\r\n            });\r\n          });\r\n          resolve(items);\r\n        })\r\n        .catch((error) => {\r\n          console.log(\"Error getting documents: \", error);\r\n        });\r\n      });\r\n  }\r\n\r\n  // 이미지 압축하기\r\n  const handleImageCompression = async () => {\r\n    console.log('========= 이미지 압축시작');\r\n\r\n    let items = await getItems();\r\n    console.log('전체 아이템: ',items)\r\n\r\n    items.forEach(async (item) => {\r\n      console.log('업데이트 호출 시작: ', item);\r\n      updateImage(item.id, item.url, item.thumbnailUrl);\r\n    });\r\n  }\r\n\r\n  async function updateImage(docId, url, thumbnailUrl) {\r\n    let mainRef = await storageService.refFromURL(url);\r\n    let thumbRef = \"\";\r\n    if (thumbnailUrl !== \"\" && thumbnailUrl !== undefined) {\r\n      thumbRef = await storageService.refFromURL(thumbnailUrl);\r\n    } \r\n\r\n    if (mainRef.name.indexOf('.') > 0) {\r\n      let ext = mainRef.name.split('.');\r\n      setExt(ext[ext.length - 1]);\r\n    }\r\n\r\n    const init = await fetch(url, {method: \"get\"});\r\n    const blob = await init.blob();\r\n    compressedFile(blob, mainRef.name, thumbRef.name, docId);\r\n  }\r\n\r\n  async function compressedFile(blob, originFileName, thumbFileName, docId) {\r\n    console.log(`originalFile size ${blob.size / 1024 / 1024} MB`);\r\n    console.log('원본 파일 이름: ', originFileName);\r\n\r\n    const options = {\r\n      maxSizeMB: 1,\r\n      maxWidthOrHeight: 1000,\r\n      useWebWorker: true,\r\n      initialQuality: 0.7\r\n    }\r\n    try {\r\n      const compressedFile = await imageCompression(blob, options);\r\n      console.log(`compressedFile size ${compressedFile.size / 1024 / 1024} MB`);\r\n\r\n      let thumbnailFile = await getThumbnailFile(compressedFile);\r\n      console.log('썸네일 파일: ', thumbnailFile);\r\n\r\n      let res = await Promise.all([\r\n        ref.child(`${doc}/${originFileName}`).delete()\r\n        .then(() => {\r\n          console.log(originFileName + ' 1차 삭제 완료');\r\n        })\r\n        .catch((error) => {\r\n          console.log('1차 삭제 실패: ', error);\r\n          ref.child(`${oldDoc}/${originFileName}`).delete().then(() => {\r\n            console.log(originFileName + ' 2차 삭제 완료');\r\n          }).catch((error) => {\r\n            console.log('2차 삭제 실패: ', error);;\r\n          });\r\n        }),\r\n\r\n        ref.child(`thumbnails/${thumbFileName}`).delete()\r\n        .then(() => {\r\n          console.log(thumbFileName + ' 썸네일 삭제 완료');\r\n        })\r\n        .catch((error) => {\r\n          console.log('썸네일 삭제 실패: ', error);\r\n        }),\r\n\r\n        ref.child(`${doc}/${uuidv4()}${ext ? '.'+ext : '.jpg'}`).put(compressedFile)\r\n        .then((snapshot) => {\r\n          return snapshot.ref.getDownloadURL();\r\n        }).catch((error) => {\r\n          console.log('재업로드 실패: ', error);\r\n        }),\r\n\r\n        ref.child(`thumbnails/${uuidv4()}.webp`).put(thumbnailFile)\r\n        .then((snapshot) => {\r\n          return snapshot.ref.getDownloadURL();\r\n        }).catch((error) => {\r\n          console.log('썸네일 재업로드 실패: ', error);\r\n        })\r\n      ]);\r\n\r\n      console.log(res);\r\n\r\n      updateAttachmentUrl(docId, res[2], res[3]);\r\n      \r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  async function getThumbnailFile(blob) {\r\n    const reader = new FileReader();\r\n    return await new Promise((resolve) => {\r\n      reader.onloadend = (finishedEvent) => {\r\n        const {\r\n          currentTarget: { result },\r\n        } = finishedEvent;\r\n        const image = new Image();\r\n        image.src = result;\r\n        image.onload = function () {\r\n          const canvas = document.createElement(\"canvas\");\r\n          canvas.width = 300;\r\n          canvas.height = 300;\r\n          canvas.getContext(\"2d\").drawImage(image, 0, 0, 300, 300);\r\n          canvas.toBlob((blob) => {\r\n            resolve(blob);\r\n          }, 'image/webp', 0.7);\r\n        }\r\n      }\r\n      reader.readAsDataURL(blob);  \r\n    })\r\n    \r\n  }\r\n\r\n  async function updateAttachmentUrl(docId, url, thumbnailUrl) {\r\n    dbService.doc(`items/${docId}`).update({\r\n      attachmentUrl: url,\r\n      thumbnailUrl: thumbnailUrl,\r\n    });\r\n    console.log('======== 업데이트 완료. 변경 파일 URL: ', url, thumbnailUrl);\r\n  } \r\n\r\n  // 기존 데이터에 썸네일 이미지 없는 경우 썸네일 이미지 만들어 추가하기\r\n  const handleCreateThumbnail = async () => {\r\n    console.log('========= 썸네일 이미지 추가하기 시작');\r\n    let items = await getItems();\r\n    console.log('전체 아이템: ',items)\r\n\r\n    items.forEach(async (item) => {\r\n      console.log('업데이트 호출 시작: ', item);\r\n      if (!item.thumbnailUrl) {\r\n        updateThumbnail(item.id, item.url);\r\n      }\r\n    });\r\n  }\r\n\r\n  async function updateThumbnail(docId, url) {\r\n    let mainRef = await storageService.refFromURL(url);\r\n    const init = await fetch(url, {method: \"get\"});\r\n    const blob = await init.blob();\r\n    createThumbnail(blob, mainRef.name, docId);\r\n  }\r\n\r\n  async function createThumbnail(blob, originFileName, docId) {\r\n    console.log('원본 파일 이름: ', originFileName);\r\n\r\n    try {\r\n      let thumbnailFile = await getThumbnailFile(blob);\r\n      console.log('썸네일 파일: ', thumbnailFile);\r\n\r\n      let res = await new Promise((resolve) => {\r\n        ref.child(`thumbnails/${uuidv4()}.webp`).put(thumbnailFile)\r\n        .then((snapshot) => {\r\n          resolve(snapshot.ref.getDownloadURL());\r\n        }).catch((error) => {\r\n          console.log('썸네일 재업로드 실패: ', error);\r\n        })\r\n      });\r\n\r\n      updateThumbnailUrl(docId, res);\r\n      \r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  async function updateThumbnailUrl(docId, thumbnailUrl) {\r\n    dbService.doc(`items/${docId}`).update({\r\n      thumbnailUrl: thumbnailUrl,\r\n    });\r\n    console.log('======== 업데이트 완료. 변경 파일 URL: ', thumbnailUrl);\r\n  } \r\n\r\n  // 썸네일 이미지 만들기\r\n  const handleImageConverter = () => {\r\n    console.log('========= 썸네일 이미지 만들기 시작');\r\n    const file = document.getElementById(\"origin-image\").files[0];\r\n    resizeImage(file);\r\n  }\r\n\r\n  function resizeImage(file) {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = function (event) {\r\n      const image = new Image();\r\n      image.width = width;\r\n      image.height = height;\r\n      image.title = 'thumbnail';\r\n      image.src = reader.result;\r\n\r\n      image.onload = function () {\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        canvas.getContext(\"2d\").drawImage(image, 0, 0, width, height);\r\n        const dataUri = canvas.toDataURL(\"image/webp\", 0.7);\r\n        const thumb = new Image();\r\n        thumb.src=dataUri;\r\n        document.getElementById('thumbnail').appendChild(thumb);\r\n      }\r\n    }\r\n  }\r\n\r\n  const changeStartDate = (event) => {\r\n    setStartDate(event.target.value);\r\n  }\r\n\r\n  const changeEndDate = (event) => {\r\n    setEndDate(event.target.value);\r\n  }\r\n\r\n  const changeWidht = (event) => {\r\n    setWidth(event.target.value);\r\n  }\r\n\r\n  const changeHeight = (event) => {\r\n    setHeight(event.target.value);\r\n  }\r\n\r\n  return (\r\n    <section className=\"wrapContainer dark\">\r\n      <div className=\"container\"  style={{color:\"white\"}}>\r\n        <div style={{display:'flex', alignItems:'center', gap:20}}>\r\n          <div style={{margin:10}}>\r\n            시작일 <input type=\"date\" onChange={changeStartDate} style={{padding:10, margin:10}} />\r\n          </div>\r\n          <p>~</p>\r\n          <div>\r\n            종료일 <input type=\"date\" onChange={changeEndDate} style={{padding:10, margin:10}} />\r\n          </div>\r\n        </div>\r\n        <div style={{display:\"flex\", gap:30, justifyContent:'center', alignItems:'flex-start', textAlign:'center'}}>\r\n          <div style={{display:\"flex\", flexDirection:\"column\", gap:50}}>\r\n            <div>\r\n              <h2 style={{marginBottom:0}}>기간별 이미지 압축하기</h2>\r\n              <input type=\"button\" className=\"factoryInput__arrow\" onClick={handleImageCompression} value=\"Start\" />\r\n            </div>\r\n            <div>\r\n              <h2 style={{marginBottom:0}}>기간별 썸네일만 추가하기</h2>\r\n              <input type=\"button\" className=\"factoryInput__arrow\" onClick={handleCreateThumbnail} value=\"Start\" />\r\n            </div>\r\n            <div>\r\n              <h2 style={{marginBottom:0}}>기간별 이미지 다운로드</h2>\r\n              <input type=\"button\" className=\"factoryInput__arrow\" onClick={handleImageDownload} value=\"Download\" />\r\n            </div>\r\n          </div>\r\n          <div style={{display:'flex', flexDirection:'column', alignItems:'center', gap:10}}>\r\n            <h2>썸네일 이미지 만들기</h2>\r\n            <div>\r\n              width <input type=\"number\" onChange={changeWidht} style={{width:100, padding:10, borderRadius:5, marginRight:10}} />\r\n              height <input type=\"number\" onChange={changeHeight} style={{width:100, padding:10, borderRadius:5}} />\r\n            </div>\r\n            <input type=\"file\" id=\"origin-image\" style={{width:290, color:'#333', backgroundColor:'white', padding:10, borderRadius:5}} />\r\n            <input type=\"button\" className=\"factoryInput__arrow\" onClick={handleImageConverter} value=\"Create\" />\r\n            <div id=\"thumbnail\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default ImageCompressior;"],"names":["useState","ext","setExt","startDate","setStartDate","endDate","setEndDate","width","setWidth","height","setHeight","doc","oldDoc","ref","storageService","url","date","a","console","log","fetch","method","init","blob","fileName","URL","createdUrl","createObjectURL","document","createElement","href","download","body","appendChild","click","window","revokeObjectURL","getItems","count","items","Promise","resolve","dbService","where","process","orderBy","get","then","snapshot","docs","forEach","push","num","id","data","attachmentUrl","thumbnailUrl","catch","error","handleImageCompression","item","updateImage","docId","mainRef","thumbRef","undefined","name","indexOf","split","length","compressedFile","originFileName","thumbFileName","size","options","maxSizeMB","maxWidthOrHeight","useWebWorker","initialQuality","imageCompression","getThumbnailFile","thumbnailFile","all","child","delete","uuidv4","put","getDownloadURL","res","updateAttachmentUrl","reader","FileReader","onloadend","finishedEvent","result","currentTarget","image","Image","src","onload","canvas","getContext","drawImage","toBlob","readAsDataURL","update","handleCreateThumbnail","updateThumbnail","createThumbnail","updateThumbnailUrl","className","style","color","display","alignItems","gap","margin","type","onChange","event","target","value","padding","justifyContent","textAlign","flexDirection","marginBottom","onClick","borderRadius","marginRight","backgroundColor","file","title","dataUri","toDataURL","thumb","getElementById","resizeImage","files"],"sourceRoot":""}